<!doctype html>
<html>

<style>
  .config-item {
    margin-bottom: 1rem;
  }

  .field-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .field-item {
    border: 1px solid #ddd;
    padding: 0.25rem 0.5rem;
    cursor: pointer;
  }
</style>

<body class="container flex flex-col h-full gap-8">
  <!-- 字段选择 -->
  <h2 class="text-2xl">高级检索设置</h2>
  <!-- 行数设置 -->
  <div class="config-item">
    <label>行数限制：</label>
    <input type="number" !value="opts.page_size" @input='opts.page_size=Number($event.target.value)' min="1"
      max="100" />
  </div>
  <!-- 排序设置 -->
  <div class="config-item flex">
    <label>排序字段：</label>
    <input-select class="flex-grow" v:value='opts.sort_by' :options='options()'></input-select>
    <label style="margin-left:1rem">排序方向：</label>
    <input-select class="flex-grow" v:value='opts.order' :options='directionOpts'></input-select>
  </div>
  <div class="config-item">
    <h4>选择显示字段：</h4>
    <div class="field-list mt-4">
      <span v-for="field in keys" :class="['field-item', field.hidden?'':'bg-blue-100' ]"
        @click="field.hidden=!field.hidden">
        {{ field.label || field.name }}
      </span>
    </div>
  </div>
  <!-- 筛选设置 -->
  <div class="config-item">
    <h4 class="mb-4">字段筛选：</h4>
    <div class="flex flex-wrap justify-between">
      <div v-for="field in selectedFieldsConfig()" class="mb-2">
        <div refu='input' label_width='8rem' :label='field.label' v:value='filters[field.name]' type='text'></div>
      </div>
    </div>
  </div>
  <div class="flex-grow"></div>
  <button class="float-right bg-blue-400 rounded px-4 py-2" @click="applyConfig">应用配置</button>
</body>
<script setup>
  // 默认配置
  keys = [
    {name: 'id', label: 'ID', type: 'number'},
    {name: 'name', label: '姓名', type: 'string'},
  ]
  opts = {
    page: 1,
    page_size: 10,
    keyword: '',
    keywords: {},
    sort_by: 'created_at',
    order: 'desc',
  }

  selectedFields = ['id', 'name'] // 已选中字段
  rowLimit = 20 // 行数限制
  sortField = '' // 排序字段
  sortDirection = 'asc' // 排序方向
  filters = {} // 筛选条件
  options = () => keys.map(f => {
    return {value: f.name, label: f.label}
  })
  directionOpts = [
    {value: 'asc', label: '升序'},
    {value: 'desc', label: '降序'}
  ]

  // 计算属性
  selectedFieldsConfig = () => keys.filter(f => !f.hidden)

  // 方法
  toggleField = (key) => {
    if (selectedFields.includes(key)) {
      selectedFields = selectedFields.filter(f => f !== key)
    } else {
      selectedFields.push(key)
    }
  }
  updateFilter = (fieldKey, value) => {
    if (value) {
      filters[fieldKey] = value
    } else {
      delete filters[fieldKey]
    }
  }
  applyConfig = () => {
    console.log('当前配置:', {
      fields: selectedFields,
      limit: rowLimit,
      sort: {field: sortField, direction: sortDirection},
      filters: filters
    })
  }
</script>
<script>
</script>

</html>
